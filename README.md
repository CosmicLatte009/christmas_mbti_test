# 🎄크리스마스 MBTI 유형 테스트🎄

</br>

**[배포 URL]**

- URL: https://christmas-mbti-test.netlify.app

</br>

# 1. 개발 환경

## **개발 환경**

- React
- React-router
- useState, useEffect, useNavigate, useSearchParams
- CSS module, Sass

```
react: "^18.2.0",
react-router-dom: "^6.4.3",
sass: "^1.56.1",
sass-loader: "^13.2.0"
```

## **서비스 배포 환경**

- 🔗netlify

## **SEO 최적화 도구**

- 네이버 웹 마스터 도구

</br>

# 2. 폴더 트리 구조

```
📦
├─ public
│  ├─ _redirects
│  ├─  favicon.svg
│  ├─ index.html
│  ├─ robots.txt
│  └─ sitemap.xml
└─ src
│  ├─ App.js
│  ├─ index.js
│  ├─ assets
│  │  ├─ data
│  │  │  ├─ questionData.js
│  │  │  └─ resultData.js
│  │  ├─ svg
│  │  └─ typeImage
│  ├─ components
│  │  ├─ common
│  │  │  ├─ Button.jsx
│  │  │  └─ Wrapper.jsx
│  │  ├─ guage
│  │  │  ├─ Guage.jsx
│  │  │  └─ GuageHeart.jsx
│  │  ├─ match
│  │  │  ├─ Match.jsx
│  │  │  └─ MatchBox.jsx
│  │  ├─ resultDesc
│  │  │  ├─ ResultDesc.jsx
│  │  │  └─ ResultList.jsx
│  │  └─ shareButton
│  │     ├─ FacebookShareButton.jsx
│  │     ├─ KakaoShareButton.jsx
│  │     ├─ ShareButton.jsx
│  │     └─ TwitterShareButton.jsx
│  ├─ page
│  │  ├─ AllResultPage.jsx
│  │  ├─ HomePage.jsx
│  │  ├─ QuestionPage.jsx
│  │  └─ ResultPage.jsx
│  └─ style
│     ├─ commonStyle
│     │  ├─ Button.module.scss
│     │  ├─ Wrapper.module.scss
│     │  ├─ _utils.scss
│     │  └─ reset.css
│     ├─ guageStyle
│     │  ├─ Guage.module.scss
│     │  └─ GuageHeart.module.scss
│     ├─ matchStyle
│     │  ├─ Match.module.scss
│     │  └─ MatchBox.module.scss
│     ├─ pagesStyle
│     │  ├─ AllResultPage.module.scss
│     │  ├─ HomePage.module.scss
│     │  ├─ QuestionPage.module.scss
│     │  └─ ResultPage.module.scss
│     ├─ resultDescStyle
│     │  ├─ ResultDesc.module.scss
│     │  └─ ResultList.module.scss
│     └─ shareButtonStyle
│        └─ ShareButton.module.scss
├─ netlify.toml
├─ package-lock.json
└─ package.json  

```

©generated by [Project Tree Generator](https://woochanleee.github.io/project-tree-generator)

</br>

# 3. 구현 기능

## **questionPage 로직** ✅

### **1. 유형별 점수 추가하기**

```
const [totalScore, setTotalScore] = useState([
		{ id: "EI", score: 0 },
		{ id: "SN", score: 0 },
		{ id: "TF", score: 0 },
		{ id: "JP", score: 0 },
	]);

const newScore = totalScore.map((s) =>
	s.id === type ? { id: s.id, score: s.score + n } : s);
	setTotalScore(newScore);
```

- QuestionData. js의 type과 QuestionPage.js의 totalscore useState의 id가 일치할 때 score에 점수를 추가한다.

- 일치하지 않으면 state의 기존 객체를 유지한다.

</br>

### **2. 문항 수 증가시키다가 12번 문항에서 mbti 도출**

```
11번 문제까진 다음 문제로 문제수 증가
 if (QuestionData.length !== questionNum + 1) {
		setQuestionNum(questionNum + 1);
} else {
        //mbti 도출
		const mbti = newScore.reduce(
			(acc, curr) =>
			acc + (curr.score >= 2 ?
            curr.id.slice(0, 1) : curr.id.slice(1, 2)), ""
		);
        //결과 페이지로 이동
        navigate({
            pathname: "/result",
            search: `?${createSearchParams({ mbti: mbti })}`,
        });
    }
```

- 문항 수 11번까지 증가시키기

  questionNum이 QuestionData.js의 길이와 일치하지 않을 때 questionNum을 1씩 증가시켜준다.

- 12번 문항에서 mbit 도출하기

  문항별 점수(score) 저장된 newScore 배열을 돌면서 점수가 2보다 크거나 같으면 앞의 알파벳을, 작으면 뒤의 알파벳을 acc에 저장한다. 그리고 직전에 동작한 콜백 함수가 리턴한 값을 acc에 전부 모아 mbti 유형을 완성한다.

- 결과 페이지로 이동

  URL의 result 경로(path) 뒤에 붙는 쿼리(query)를 설정. `/result?mbti=ENFP` 형태의 URL로 나온다.

</br>

## **resultPage 로직** ✅

### **1. QuestionPage로부터 mbti 데이터 받아오기**

```
const navigate = useNavigate();
const [searchParams] = useSearchParams();
const mbti = searchParams.get("mbti");

const [resultData, setResultData] = useState({});

useEffect(() => {
const result = ResultData.find((s) => s.type === mbti);
	setResultData(result);
	}, [mbti]);
```

- QuestionData의 mbti query를 가져오고, mbti가 바뀔 때마다 바뀐 mbti와 일치하는 ResultData의 type을 찾아서 해당 데이터를 가져온다.

 </br>

> 참고 GitHub: https://github.com/ggombee/catmbti

  </br>

# 4. 트러블슈팅

## **React / JavaScript** ✅

### **1. 데이터 개행마다 list로 바꾸기**

```
const arrJealousy = (resultData.jealousyDesc || "").split("\n");
 return (<ul>
		{arrJealousy.map((item) => (
			<li key={item}>{item}</li>
          ))}
		</ul>)
```

- `split` 사용하여 `\n` 개행 단위로 데이터 끊어서 list로 렌더링.

</br>

### **2. 특정 number만큼 반복문 사용하고 싶을 때는 숫자를 배열로 바꿔서 사용하기**

```
const N = 5;   // 길이 N을 5라고 가정
let arr = new Array(N).fill(0);
let arr2 = new Array(N).fill(0);

//프로젝트에서 쓰인 코드
const jealousyHearts = resultData.jealousyGuage;
	let jealousyHeartArr = new Array(jealousyHearts).fill(0);
```

</br>

### **3. React에서 페이지 이동 시 스크롤 맨 위로 오게 하기**

```
useEffect(() => {
		window.scrollTo(0, 0);
	}, []);
```

</br>

### **4. map에 고유한 key를 설정하라는 정확한 의미**

- '고유한 key'가 필요한 이유는 `map`으로 반복문 돌리는 리스트의 요소가 하나씩 구분되어야하기 때문이다. 때문에 고유한 데이터 그 자체가 필요한 것이지, 컴포넌트별로 key 이름이 겹치는건 괜찮다.

- id 사용하는 경우

  리스트에 고유한 id가 있는 경우에는 그대로 id 사용한다.

```
{Data.map((item, index) => (
					<div key={item.id}>{item}</div>
				))}
```

- index 사용하는 경우

  리스트에 고유한 id가 없는 경우(ex. 단순 배열)는 보통 index를 사용한다.

  리액트에서 key를 명시적으로 넣어주지 않으면 기본적으로 index값을 key값으로 사용한다.
  단, 아이템의 순서가 바뀔 수 있는 경우에는 index를 사용하는걸 권장하는 않는다.

```
{arr.map((desc, index) => (
					<div key={index}>{desc}</div>
				))}
```

</br>

## **CSS** ✅

### **1. 가상요소 작동 안될 때**

- `content=""` 속성 추가

- `display: inline-block` 혹은 `display: block` 속성 추가

### **2. list 줄바뀌어도 들여쓰기**

- 화면을 보면서 적절한 음수값을 적어주면 된다.

```
text-indent: -20px
```

### **3. svg 색상 CSS에서 바꾸기**

- svg 코드에서 `style="fill:current";`로 설정하고 CSS에서 fill 색상 변경.

</br>

### **4. 모바일에서 hover가 적용되지 않을 때**

- 미디어 쿼리로 hover 기능 있는 기기와 없는 기기를 구분해서 hover 기능 있는 쪽에만 hover 효과 적용해주는 방식.

  단, hover 기능 없는 기기에는 아예 효과가 제거됨에 주의.

  ```
  @media (hover: hover) and (poitner: fine) {요소:hover {속성: 속성값;}}
  ```

- hover 대신 active에 ripple 효과 애니메이션 주기

  ```
  요소{
  background-position: center;
  transition: background 0.5s;
  }

  요소:active {
      background-color: map-get($colors, back);
      background-size: 100%;
      transition: background 0s;
      }
  ```

  </br>

## **Netlify 배포** ✅

### **1. 배포 build command 에러 나는 경우**

1. **환경 변수 설정**

   netlify 사이트에서 [site settings]-[Build & deploy]-[Build settings] 의

   [Key]와 [Value] 설정.
   (이번에 필수는 아니었다.)

    </br>

2. **Cl=false npm run build 설정**

   netlify 사이트에서 [site settings]-[Build & deploy]-[Build settings]의 [Build command] 에

   `Cl=false npm run start` 입력.

   [Build command]과 [Publish directory]는 내 애플리케이션의 netlify.toml 파일 내용과 동일해야한다.

    </br>

3. **netlify.toml 파일 설정**

   ```
   [build]
   publish = "build"
   command = "Ci=false npm run build"
   ```

   내 애플리케이션의 public 폴더 내에 넣는다.

    </br>

### **2. 배포 후 404 에러가 뜨는 경우**

</br>

`_redirect 파일` 생성하여 내 애플리케이션의 public 폴더 내에 넣는다.

어떠한 경로로 들어와도 (/\*), 200 상태코드를 내려주며, index.html 파일을 렌더해주는 파일.

```
/* /index.html 200
```

</br>

- **왜 배포 후 새로고침했을 때 404에러가 뜰까?**

  > 데이터를 랜딩페이지에서 받아왔다가 다른 페이지로 옮긴 후 새로고침하는 바람에 받아왔던 데이터가 날아간 상태로 옮겨진 페이지가 다시 렌더링 되기 떄문.

- **Build command란?**

  > build를 해야지 배포가 가능한 파일로 만들 수 있는데, 이를 구현하기 위한 코드를 어떻게 할 것인지를 작성해줘야 한다.

- **npm run build란?**

  > package.json의 scripts에 있는 명령어를 가져온 것. 다르게 설정한 경우, netlify에도 다르게 설정한 것을 알려주는 과정이 필요하다.

- **"Cl="란?**

  > Netlify에서는 그냥 npm run build를 하면 제대로 작동하지 않기 때문에 "Cl="를 붙여줘야 한다.

- **환경변수의 용도**

  > 배포하고 페이지 주소도 제대로 생성됐는데, api key를 받아오지 못하고 url만 받아오는 401 error가 발생하는 경우에 설정해주면 해결할 수 있다.
  > netlify 사이트에서 [Environment]에 프로젝트에서 사용하는 api key를 설정한 후, [Deploys]-[trigger deploy] 클릭.

</br>

## **Git GitHub** ✅

### **1. 변경사항 최근 커밋에 덮어씌우고 싶은 경우**

```
git commit --amend
```

변경사항 add 후 해당 실행하면 마지막 커밋에 덮어씌워진다.

</br>

### **2. `git reset --hard` 를 취소하고 싶은 경우**

1. 삭제된 커밋을 포한 모든 커밋 히스토리 조회하기
   ```
   git reflog
   ```

2) 조회한 내역을 바탕으로 특정 변경사항 취소
   ```
   git reset HEAD@{n}
   ```
   조회한 내역의 n번째 변경사항 취소.
